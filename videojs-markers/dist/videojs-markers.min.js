/*! videojs-markers - v0.9.0 - 2017-12-13
* Copyright (c) 2017 ; Licensed  */

!function(e,r){if("function"==typeof define&&define.amd)define(["video.js"],r);else if("undefined"!=typeof exports)r(require("video.js"));else{r(e.videojs),e.videojsMarkers={}}}(this,function(e){"use strict";function r(e){var r,t={top:0,bottom:0,left:0,width:0,height:0,right:0};try{r=e.getBoundingClientRect()}catch(e){r=t}return r}var t=function(e){return e&&e.__esModule?e:{default:e}}(e),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n={markerStyle:{width:"7px","border-radius":"30%","background-color":"red"},markerTip:{display:!0,text:function(e){return"Break: "+e.text},time:function(e){return e.time}},breakOverlay:{display:!1,displayTime:3,text:function(e){return"Break overlay: "+e.overlayText},style:{width:"100%",height:"20%","background-color":"rgba(0,0,0,0.7)",color:"white","font-size":"17px"}},onMarkerClick:function(e){},onMarkerReached:function(e,r){},markers:[]},a=-1;t.default.plugin("markers",function(e){function o(){p.sort(function(e,r){return y.markerTip.time(e)-y.markerTip.time(r)})}function l(e){e.forEach(function(e){e.key=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){var t=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==r?t:3&t|8).toString(16)})}(),x.el().querySelector(".vjs-progress-holder").appendChild(function(e){var i=t.default.createEl("div",{},{"data-marker-key":e.key,"data-marker-time":y.markerTip.time(e)});return c(e,i),i.addEventListener("click",function(r){var t=!1;if("function"==typeof y.onMarkerClick&&(t=!1===y.onMarkerClick(e)),!t){var i=this.getAttribute("data-marker-key");x.currentTime(y.markerTip.time(k[i]))}}),y.markerTip.display&&function(e){e.addEventListener("mouseover",function(){var t=k[e.getAttribute("data-marker-key")];if(b){b.querySelector(".vjs-tip-inner").innerText=y.markerTip.text(t),b.style.left=u(t)+"%";var i=r(b),n=r(e);b.style.marginLeft=-parseFloat(i.width/2)+parseFloat(n.width/4)+"px",b.style.visibility="visible"}}),e.addEventListener("mouseout",function(){b&&(b.style.visibility="hidden")})}(i),i}(e)),k[e.key]=e,p.push(e)}),o()}function u(e){return y.markerTip.time(e)/x.duration()*100}function c(e,t){t.className="vjs-marker "+(e.class||""),Object.keys(y.markerStyle).forEach(function(e){t.style[e]=y.markerStyle[e]});var i=e.time/x.duration();if((i<0||i>1)&&(t.style.display="none"),t.style.left=u(e)+"%",e.duration)t.style.width=e.duration/x.duration()*100+"%",t.style.marginLeft="0px";else{var n=r(t);t.style.marginLeft=n.width/2+"px"}}function f(e){T&&(g=a,T.style.visibility="hidden"),h=a;var r=[];e.forEach(function(e){var t=p[e];if(t){delete k[t.key],r.push(e);var i=x.el().querySelector(".vjs-marker[data-marker-key='"+t.key+"']");i&&i.parentNode.removeChild(i)}}),r.reverse(),r.forEach(function(e){p.splice(e,1)}),o()}function s(){if(y.breakOverlay.display&&!(h<0)){var e=x.currentTime(),r=p[h],t=y.markerTip.time(r);e>=t&&e<=t+y.breakOverlay.displayTime?(g!==h&&(g=h,T&&(T.querySelector(".vjs-break-overlay-text").innerHTML=y.breakOverlay.text(r))),T&&(T.style.visibility="visible")):(g=a,T&&(T.style.visibility="hidden"))}}function d(){!function(){if(p.length){var r=function(e){return e<p.length-1?y.markerTip.time(p[e+1]):x.duration()},t=x.currentTime(),i=a;if(h!==a){var n=r(h);if(t>=y.markerTip.time(p[h])&&t<n)return;if(h===p.length-1&&t===x.duration())return}if(t<y.markerTip.time(p[0]))i=a;else for(var o=0;o<p.length;o++)if(n=r(o),t>=y.markerTip.time(p[o])&&t<n){i=o;break}i!==h&&(i!==a&&e.onMarkerReached&&e.onMarkerReached(p[i],i),h=i)}}(),s(),e.onTimeUpdateAfterMarkerUpdate&&e.onTimeUpdateAfterMarkerUpdate()}function m(){y.markerTip.display&&(b=t.default.createEl("div",{className:"vjs-tip",innerHTML:"<div class='vjs-tip-arrow'></div><div class='vjs-tip-inner'></div>"}),x.el().querySelector(".vjs-progress-holder").appendChild(b)),x.markers.removeAll(),l(y.markers),y.breakOverlay.display&&(T=t.default.createEl("div",{className:"vjs-break-overlay",innerHTML:"<div class='vjs-break-overlay-text'></div>"}),Object.keys(y.breakOverlay.style).forEach(function(e){T&&(T.style[e]=y.breakOverlay.style[e])}),x.el().appendChild(T),g=a),d(),x.on("timeupdate",d),x.off("loadedmetadata")}if(!t.default.mergeOptions){var v=function(e){return!!e&&"object"===(void 0===e?"undefined":i(e))&&"[object Object]"===toString.call(e)&&e.constructor===Object};t.default.mergeOptions=function e(r,t){var i={};return[r,t].forEach(function(r){r&&Object.keys(r).forEach(function(t){var n=r[t];v(n)?(v(i[t])||(i[t]={}),i[t]=e(i[t],n)):i[t]=n})}),i}}t.default.createEl||(t.default.createEl=function(e,r,i){var n=t.default.Player.prototype.createEl(e,r);return i&&Object.keys(i).forEach(function(e){n.setAttribute(e,i[e])}),n});var y=t.default.mergeOptions(n,e),k={},p=[],h=a,x=this,b=null,T=null,g=a;x.on("loadedmetadata",function(){m()}),x.markers={getMarkers:function(){return p},next:function(){for(var e=x.currentTime(),r=0;r<p.length;r++){var t=y.markerTip.time(p[r]);if(t>e){x.currentTime(t);break}}},prev:function(){for(var e=x.currentTime(),r=p.length-1;r>=0;r--){var t=y.markerTip.time(p[r]);if(t+.5<e)return void x.currentTime(t)}},add:function(e){l(e)},remove:function(e){f(e)},removeAll:function(){for(var e=[],r=0;r<p.length;r++)e.push(r);f(e)},updateTime:function(e){!function(e){p.forEach(function(r){var t=x.el().querySelector(".vjs-marker[data-marker-key='"+r.key+"']"),i=y.markerTip.time(r);(e||t.getAttribute("data-marker-time")!==i)&&(c(r,t),t.setAttribute("data-marker-time",i))}),o()}(e)},reset:function(e){x.markers.removeAll(),l(e)},destroy:function(){x.markers.removeAll(),T&&T.remove(),b&&b.remove(),x.off("timeupdate",s),delete x.markers}}})});